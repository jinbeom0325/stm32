## 5.19

eea-cs : eea-m 상태 감지 모니터링하여 제어 컨트롤 및 송수신 hex value

eea-rtu : EEA-CS와 RS-232C로 연결 EEA-CS로부터 제어 데이터를 수신하거나, EEA-M의 상태 정보를 EEA-CS에 전송 EEA-RTU는 EEA-CS로부터 수신한 제어 데이터를 EEA-M에 전달하고, EEA-M의 변경상태를 수신받아 EEA-CS로 전달

eea-m : EEA-RTU로부터 제어 데이터를 수신 받아 연결된 LED전등을 켜거나 끄고, 자신의 변경된 상태를 EEA-RTU로 전송

EEA-M은 연결된 PIR 센서를 통해 객체가 감지되면 자동으로 전등을 켜고 그 정보를 EEA-RTU로 전송

led 전구 : EEA-M과 연결되어 AC220V가 입력되면 불이 켜짐

## eea-m
ssr: SSR은 전자식 릴레이로, 기계적인 접점 없이 트랜지스터, 트라이액(TRIAC), 포토커플러 등으로 전기를 스위칭 (모터,히터,plc 제어 등)

ra-02 : RA-02는 LoRa 무선 통신 모듈로, Semtech의 SX1278 칩을 기반으로 한 저전력 장거리 무선통신 모듈(spi로 mcu연결)

### 동작방식 
- PIR 센서가 사람을 감지함

- 조도 센서가 어두운 상태임

- 조건이 만족되었기 때문에, RTU 또는 LoRa 모듈이 led on 명령을 자동화 모듈에 전달함

- 이때 자동화 모듈이 SSR에 신호를 주고, SSR이 조명을 실제로 ON 시킴
***
## LDR 특성표 
빛 저항값 (10 Lux 기준, KΩ 단위)
| 범위 (KΩ)   | 설명            |
| --------- | ------------- |
| 5–10 KΩ   | 매우 민감한 LDR    |
| 10–20 KΩ  | 일반적인 밝기 반응    |
| 20–30 KΩ  | 보통 수준의 민감도    |
| 30–50 KΩ  | 낮은 감도의 LDR    |
| 50–100 KΩ | 어두운 환경에 더 민감함 |

암저항 (Dark resistance, MΩ 단위)
| 암저항 (MΩ) | 설명                          |
| -------- | --------------------------- |
| 0.5 MΩ   | 감도가 낮고, 어두운 곳에서도 전류가 흐름     |
| 1 MΩ     | 비교적 낮은 암저항                  |
| 2 MΩ     | 중간 정도                       |
| 3 MΩ     |                             |
| 5 MΩ     | 높은 암저항                      |
| 10 MΩ    | 매우 높은 암저항, 어두운 곳에서 거의 전류 없음 |
***

## HC-SR501센서(PIR)
- 점퍼로 선택 가능

- 비반복 트리거: 감지되면 HIGH, 딜레이 후 LOW

- 반복 트리거: 감지된 상태에서 사람이 계속 움직이면 HIGH 상태가 연장됨

- 출력이 LOW로 내려간 뒤 일정 시간(기본: 2.5초) 동안 센서가 다시 작동하지 않음. → 잡음 방지, 간섭 방지 목적

- 보드 위에 있는 **감도 조절 가변저항(포텐셔미터)**을 시계 방향(오른쪽)으로 돌리면 감지 거리 증가 3~7미터
 
- 딜레이 시간 조절 포텐셔미터를 시계 방향으로 돌리면, 사람이 감지된 뒤 출력이 HIGH로 유지되는 시간이 늘어남 5~300

- 초기화 시간 1분 필요, 좌우 방향 이동에 가장 민감 → 센서 방향을 사람의 이동 방향과 나란하게
***

***
## UartLoRa.c
| 핀 이름    | 설명                | 연결된 STM32 GPIO |
| ------- | ----------------- | -------------- |
| **M0**  | 모드 설정 비트 0        | `GPIOB_PIN_1`  |
| **M1**  | 모드 설정 비트 1        | `GPIOA_PIN_9`  |
| **GPIO_Output** | LoRa 상태 확인용 (입출력) | `GPIOA_PIN_8`  |

| M1 | M0 | 모드 이름           | 설명              |
| -- | -- | --------------- | --------------- |
| 0  | 0  | **Normal mode** | 데이터 송수신         |
| 0  | 1  | **WOR mode**    | 수신 대기 모드 + 절전, Wake-On-Radio: 슬립 상태에서 주기적으로 깨어 수신 |
| 1  | 0  | **Config mode** | 설정 모드 (레지스터 접근), LoRa 설정용 (채널, 주소 등 설정 시 진입 필요) |
| 1  | 1  | **Deep Sleep**  | 초절전모드, 	최소 소비 전력을 위한 슬립 모드 (통신 불가)        |
***
| 함수               | 기능                   |
| ---------------- | -------------------- |
| `vSetAddrH()`    | LoRa 장치 주소 상위 바이트 설정 |
| `vReadAddrH()`   | LoRa 장치 주소 상위 바이트 읽기 |
| `vSetAddrL()`    | LoRa 장치 주소 하위 바이트 설정 |
| `vReadAddrL()`   | LoRa 장치 주소 하위 바이트 읽기 |
| `vSetChannel()`  | LoRa 통신 채널 설정        |
| `vReadChannel()` | LoRa 통신 채널 조회        |

_uchPacket[0] = SETREG;                  // 설정 명령 (0xC0)

_uchPacket[1] = _uchAddress;             // 설정할 레지스터 주소

_uchPacket[2] = _uchLenght;              // 설정할 길이

memcpy(&_uchPacket[3], _uchData, _uchLenght); // 실제 값 복사

***
## ComProtocol.c
MTable: 현재 상태를 저장하는 테이블 구조체

MOldTable: 이전 상태를 저장하는 테이블 구조체

uchZeroTable: 0으로 초기화된 테이블

uchAllRspTable: 초기 설정용 응답 테이블 (모든 응답이 완료된 것으로 가정)

iCmdFlag, iResendCount: 명령 처리 플래그 및 재전송 횟수

PirData: PIR 센서 정보 저장 구조체







