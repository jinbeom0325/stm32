## MPS(Multi-Physical Sensors) 다물리센서 학습진행중
- 여러 물리적 데이터를 동시에 측정할 수 있는 센서 시스템을 의미
***
사용 센서 : 온도/습도, 함수비, 풍속, 간극수압, 강우량 센서 

함수비 : 흙 속의 포함된 물의 양을 나타내는 비율 (토양의 온습도를 측정)

간극수압 : 토양이나 암석의 공극(빈공간)에 존재하는 물이 주변에 미치는 정수압(바깥으로 밀어내는 압력)

***
약어 | 풀 네임 | 설명
--|--|--
DL | Data Logger | 센서 데이터를 저장하는 장치 또는 소프트웨어
Svr | Server | 데이터를 제공하거나 처리하는 주체
Cli | Client | 데이터를 요청하는 주체 (사용자 기기 등)
AP | Access Point | 무선 네트워크의 중심 노드 (Wi-Fi 연결 지점)
GW | Gateway | 서로 다른 네트워크/프로토콜을 중계
ADC | Analog-to-Digital Converter | 아날로그 신호를 디지털로 변환
GPIO | General Purpose Input/Output | MCU의 범용 입출력 핀
UART | Universal Asynchronous Receiver-Transmitter | MCU와 외부 장치 간 비동기 직렬 통신
***
### ADS8688(멀티채널 16비트 ADC) 데이터 로거
| 항목 | 설명 |
|------|------|
| **제조사** | Texas Instruments (TI) |
| **ADC 해상도** | 16-bit |
| **채널 수** | 8채널 (Single-ended 입력) |
| **입력 전압 범위** | 여러 가지 Full-Scale 범위 설정 가능 (예: ±10.24V, 0~10.24V 등) |
| **인터페이스** | SPI (Serial Peripheral Interface) |
| **샘플 속도** | 최대 500kSPS (샘플/초) |
| **내장 기능** | PGA, 입력 보호 회로, 온도 센서 등 |
| **동작 전압** | 5V (아날로그), 1.8V 또는 3.3V (디지털) |

### INA226
| 항목                     | 설명                                                                 |
|------------------------|----------------------------------------------------------------------|
| **제조사**               | Texas Instruments                                                   |
| **측정 전압 범위**        | 0V ~ 36V (버스 전압)                                                |
| **전류 측정 방식**        | 셔트 저항 기반 양방향 전류 측정                                     |
| **ADC 해상도**           | 16비트                                                               |
| **통신 인터페이스**       | I²C 또는 SMBus                                                      |
| **전원 공급 전압 (Vcc)** | 2.7V ~ 5.5V                                                         |
| **프로그래머블 주소 수**  | 최대 16개 I²C 주소 설정 가능                                          |
| **전력 소비**            | 평균 330 μA                                                        |
| **동작 온도 범위**       | -40°C ~ +125°C                                                     |
| **패키지 형태**          | VSSOP-10 (3.00mm × 4.90mm)                                          |
| **주요 응용 분야**        | 배터리 관리, 서버/통신 장비, 산업용 전원 모니터링, EV 전력 분석 등     |

​IS42S32800G는 ISSI에서 제조한 256Mb(32MB) 용량의 고속 SDRAM(Synchronous DRAM) 메모리
***
| 역할              | MCU                 | ADS8688     |
| --------------- | ------------------- | ----------- |
| **MCU (STM32)** | 중앙 제어, 통신 처리        | SPI 마스터 역할  |
| **ADS8688**     | 센서 데이터를 아날로그→디지털 변환 | SPI 슬레이브 역할 |

### 센서 부분

| 항목             | HTU21D      | LM35D                |
| -------------- | ----------- | -------------------- |
| 측정 항목          | 온도 + 습도     | 온도만                  |
| 출력 방식          | 디지털 (I2C)   | 아날로그 (전압)            |
| 정확도            | 상대적으로 높음    | 보통                   |
| 마이크로컨트롤러 연결 방식 | I2C 통신 핀 필요 | ADC 핀 필요             |
| 전압 변환 필요       | 불필요 (디지털)   | 필요 (ADC 레퍼런스와 매칭 필수) |
***
## 센서

### 온습도센서 HTU21D
| 센서 핀      | 연결 라벨     | 연결 설명                     |
| --------- | --------- | ------------------------- |
| VCC       | +3.3V   | 전원 공급                     |
| GND       | GND     | 그라운드                      |
| SCL (클럭)  | HUM_SCL | STM32의 I2C PB6 클럭 핀으로 연결  |
| SDA (데이터) | HUM_SDA | STM32의 I2C PB7 데이터 핀으로 연결 |

### 풍속센서
- ADC

| 센서 선 색상 | 기능    | 연결 설명                                |
| ------- | ----- | ------------------------------------ |
| BROWN   | VCC   | 12V 전원 공급                        |
| BLACK   | GND   | GND 연결                               |
| BLUE    | 출력 신호 | STM32의 PB0 핀에 연결 (0.4V \~ 2.0V 범위) |

### 강우량센서
- GPIO
  
| 센서 신호명     | 연결 핀  | 설명                                        |
| ---------- | ----- | ----------------------------------------- |
| Rain Pulse | PJ6 | STM32의 GPIO PJ6 핀에 연결<br>TIM8 기능 가능 |

***
p23부분이 온습도 센서부분이고

p7,p32부분이 풍속센서 p24부분이 강우량센서

풍속센서는 INA226 ADC를 이용한 풍속 값 측정이고

강우량은 외부인터럽트를 이용한 강우량 측정이고 

온습도센서는  ADS8688 ADC를 이용한 온도, 습도 값 측정


| 주변 장치 | 핀               | 설명                  |
| ----- | --------------- | ------------------- |
| ADC1  | PB0             | `ADC1_INP9` 아날로그 입력 |
| I2C1  | PB6, PB7        | 각각 SCL, SDA         |
| SPI5  | PK0, PJ11, PJ10 | 각각 SCK, MISO, MOSI  |


임계값 : 경계선 이상의 값 (센서가 임계값을 초과했는지 확인하기 위해)

***
### 2025.05.12
## 습도센서 오차 
| 항목            | 값 / 설명                                    |
| ------------- | ----------------------------------------- |
| 센서 전원         | 5V (센서 사양에 맞음)                            |
| 센서 출력 전압      | 4.08V (멀티미터 측정값)                          |
| 실제 습도         | 약 60% (기상 정보 기준 등)                        |
| ADS8688 읽은 값  | 약 52250 (16bit 값, 0\~65535 범위)            |
| 코드 계산 결과      | 습도 90% 이상 (오차)                        |
| ADS8688 입력 범위 | R5 설정 (0 \~ 1.25 × Vref = 0 \~ **5.12V**) |
| Vref          | 4.096V (코드 내 `_vref`)                     |
| 입력 범위 최대값     | 4.096 × 1.25 = 5.12V                      |
***
### ads8688기능
| 항목        | 설명                                     |
| --------- | -------------------------------------- |
| 아날로그 입력   | 8채널 (CH0\~CH7), 싱글엔디드                  |
| 해상도       | 16비트                                   |
| 인터페이스     | SPI (최대 50MHz)                         |
| 입력 전압 범위  | ±2.5×Vref, ±1.25×Vref 등 **범위 선택 가능**   |
| 내부 Vref   | 4.096V (사용자가 외부로도 설정 가능)               |
| 샘플링 방식    | SAR(Successive Approximation Register) |
| 채널별 전원 끄기 | 지원 (저전력 모드)                            |
| 데이터 포맷    | 16비트 unsigned integer                  |
***
```c
ADS8688 ADC칩 채널5번,6번 입력전압 범위 설정 

void vChannel6SetR5(ADS8688 *ads)
{
	setChannelRange(SPI_Channel6, R5, ads);             
}
void vChannel5SetR5(ADS8688 *ads)
{
	setChannelRange(SPI_Channel5, R5, ads);
}
```
| 요소                  | 의미                                 |
| ------------------- | ---------------------------------- |
| `ADS8688 *ads`      | ADS8688 구조체 포인터 (SPI 통신, 상태 등 저장됨) |
| `SPI_Channel5/6`    | ADS8688 내부의 채널 번호 (CH5, CH6)       |
| `R5`                | 전압 입력 범위 설정 값. 예: `±2.5 × Vref` 등  |
| `setChannelRange()` | ADS8688에 특정 채널과 전압 범위를 설정하는 내부 함수  |
***
입력전압범위 (4.096V)
| 코드   | 이름               | 전압 범위       |
| ---- | ---------------- | ----------- |
| `R1` | ±2.5 × Vref      | ±10.24V     |
| `R2` | ±1.25 × Vref     | ±5.12V      |
| `R3` | ±0.625 × Vref    | ±2.56V      |
| `R4` | 0 \~ 2.5 × Vref  | 0 \~ 10.24V |
| `R5` | 0 \~ 1.25 × Vref | 0 \~ 5.12V  |

| 모드 이름                | 설명                 |
| -------------------- | ------------------ |
| **Auto Mode**        | 자동으로 채널들을 순차적으로 스캔 |
| **Manual Mode**      | 사용자가 선택한 채널만 변환    |
| **Auto-Repeat Mode** | 특정 채널 하나만 계속 반복 변환 |
| **Reset Mode**       | 기본값 복원 또는 초기화      |
***

| 모드 이름       | 의미       | 용도 예시                            |
| ----------- | -------- | -------------------------------- |
| `MODE_IDLE` | 대기 모드    | 아무 동작 안 하는 기본 상태                 |
| `MODE_PROG` | 프로그래밍 모드 | 레지스터 설정(채널 설정, 범위 설정 등)을 수행하는 상태 |
***





