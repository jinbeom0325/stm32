### DMA

CPU 개입 없이 데이터를 전송하는 기능

백그라운드에서 동작 -> CPU는 다른 작업 수행 가능

전송이 완료되면 인터럽트 발생 -> 효율적인 대용량 데이터 처리 가능

### DMA 구성 요소
- STM32F4/F7 계열은 2개의 DMA 컨트롤러를 가짐

- 각 DMA 컨트롤러는 8개의 스트림(Stream) 존재

- 각 스트림은 8개의 채널(Channel) 선택 가능

스트림(Stream): 데이터 전송 경로

채널(Channel): 각 스트림에서 어떤 장치와 연결될지 결정

예시: SPI3 수신 → DMA1의 Stream0, Channel0 사용(레퍼런스 매뉴얼의 DMA 테이블 참고)

### DMA 주요 설정 항목

항목 | 설명
--|--
스트림/채널 | 어떤 스트림과 채널을 쓸지 선택
우선순위 | 스트림 간 우선순위 (Software 설정 가능)
소스/목적지 주소 | 어디서 어디로 데이터를 옮길지 설정
주소 증가 여부 | 배열 등에 저장 시 주소 자동 증가 여부
전송 크기 | 몇 바이트씩 옮길 것인지 (8/16/32bit)
전송 모드 | Normal (1회), Circular (반복)
FIFO 모드 | 임시 저장공간 활용, 버스트 전송 등 지원
Burst 모드 | 여러 데이터 묶어서 빠르게 전송
Double Buffer | 두 버퍼를 번갈아 사용 (빠른 연속 전송)
전송 방향 | 메모리→주변장치, 주변장치→메모리, 메모리↔메모리(DMA2에서만)

**1. Stream & Channel 선택**
- 각 주변장치는 특정 Stream & Channel에 연결되어 있음
- 데이터시트의 DMA 매핑 테이블을 보고 선택해야 함
예: SPI3_RX → DMA1 Stream0 Channel0, I2C1_RX → DMA1 Stream0 Channel1

**2. 우선순위 설정**
- DMA 스트림 간 충돌 방지를 위한 우선순위 설정
- 소프트웨어 우선순위 + 하드웨어 우선순위
  - 하드웨어 우선순위는 Stream 번호가 작을수록 높음

**3. Source / Destination 주소**
- 어디서 데이터를 읽어오고 (source), 어디로 보낼지 (destination) 지정
- 주변장치 → 메모리 (예: ADC → RAM)
- 메모리 → 주변장치 (예: 메모리 → UART TX)
- 메모리 → 메모리도 가능 (DMA2 전용)

**4. 주소 증가 설정**
- Source, Destination 주소를 자동 증가시킬지 여부
- 예: 배열에 데이터를 저장할 때는 destination 주소 증가 필요

**5. 데이터 크기 설정**
- 8bit / 16bit / 32bit 단위로 전송

예: UART는 8bit, ADC는 12bit(→ 16bit 사용)

**6. 전송 모드 선택**
모드 | 설명
-|-
Normal | 한 번만 전송 후 끝
Circular | 끝나면 자동으로 처음부터 반복 (센서 등 연속 데이터 처리에 유용)

**7. FIFO 모드 (선택 사항)**
- 데이터 버퍼를 두어 전송 대기열을 만들어 성능 향상
- 4x 32bit (=128bit) 크기
- FIFO Threshold (1/4,1/2,3/4 full 등) 설정 가능

**8. Burst 모드 / Double buffer (선택 사항)**
- Burst: 한 번에 여러 데이터 전송 → 대역폭 효율 향상
- Double buffer: 전송 중 한 버퍼 사용하고, 다른 버퍼 준비 가능 -> 연속성 확보

### DMA예시
예시 | 설명
-|-
ADC → 메모리 | 센서 데이터를 반복 수집
메모리 → UART | 문자열 자동 전송
SPI / I2C 수신 | 수신 데이터를 자동 저장
메모리 → 메모리 | 데이터 블록 복사


